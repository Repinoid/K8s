# securitate.yaml

coordinator:
  extraVolumes:
    - name: access-control
      configMap:
        name: trino-access-control
  extraVolumeMounts:
    - name: access-control
      mountPath: /etc/trino/access-control

worker:
  extraVolumes:
    - name: access-control
      configMap:
        name: trino-access-control
  extraVolumeMounts:
    - name: access-control
      mountPath: /etc/trino/access-control

accessControl:
  type: configmap
  refreshPeriod: 60s
  configFile: "rules.json"
  rules:
    rules.json: |-
      {
        "catalogs": [
          {
            "user": "trino",
            "catalog": ".*",
            "allow": "all"
          },
          {
            "group": "finance|human_resources",
            "catalog": "postgres",
            "allow": true
          },
          {
            "catalog": "hive",
            "allow": "all"
          },
          {
            "user": "yandex",
            "catalog": "postgresql",
            "allow": "read-only"
          },
          {
            "catalog": "system",
            "allow": "none"
          }
        ],
        "schemas": [
          {
            "user": "admin",
            "schema": ".*",
            "owner": true
          },
          {
            "user": "guest",
            "owner": false
          },
          {
            "catalog": "default",
            "schema": "default",
            "owner": true
          }
        ]
      }


ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # Без заголовков X-Forwarded-*
  hosts:
    - host: trino.k8c.ru
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: trino
              port:
                number: 8080
  tls:
    - secretName: trino-tls-secret
      hosts:
        - trino.k8c.ru

additionalConfigProperties:
  - http-server.process-forwarded=true          

# config:
#   http-server.process-forwarded: false  # Отключаем проверку forwarded headers